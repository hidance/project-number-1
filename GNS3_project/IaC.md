–¶–µ –ø–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ "–í–∏—â–∏–π —Ä—ñ–≤–µ–Ω—å". –ó–∞—Ä–∞–∑ —Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—à Ansible —è–∫ "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—É –¥—Ä—É–∫–∞—Ä—Å—å–∫—É –º–∞—à–∏–Ω–∫—É" (–ø—Ä–æ—Å—Ç–æ –Ω–∞–¥—Å–∏–ª–∞—î—à –∫–æ–º–∞–Ω–¥–∏).

–°–ø—Ä–∞–≤–∂–Ω—ñ–π IaC (Infrastructure as Code) ‚Äî —Ü–µ –∫–æ–ª–∏ —Ç–∏ –Ω–µ –ø–∏—à–µ—à –∫–æ–º–∞–Ω–¥–∏ Cisco.
–¢–∏ –ø–∏—à–µ—à "–ë–∞–∂–∞–Ω–∏–π —Å—Ç–∞–Ω" (Desired State) —É —Ñ–∞–π–ª–∞—Ö YAML, –∞ Ansible —Å–∞–º –≥–µ–Ω–µ—Ä—É—î –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –®–∞–±–ª–æ–Ω–∏ (Jinja2).

–û—Å—å 3 —Ä—ñ–≤–Ω—ñ IaC, —è–∫—ñ —Ç–∏ –º–æ–∂–µ—à —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–ª—è –¥–∏–ø–ª–æ–º–∞. –Ø —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∑—Ä–æ–±–∏—Ç–∏ –†—ñ–≤–µ–Ω—å 2 (Templating) ‚Äî —Ü–µ –Ω–∞–π–µ—Ñ–µ–∫—Ç–Ω—ñ—à–µ.

–†—ñ–≤–µ–Ω—å 1: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü—ñ—è" (Golden Configuration)

–Ü–¥–µ—è: –í—Å—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó –º–∞—é—Ç—å –±—É—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –æ–¥–Ω–∞–∫–æ–≤–æ (NTP, Syslog, Banner, SNMP).
–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î: –¢–∏ –æ–ø–∏—Å—É—î—à –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —É –∑–º—ñ–Ω–Ω–∏—Ö, —ñ Ansible "—Ä–æ–∑–º–∞–∑—É—î" —ó—Ö –ø–æ –≤—Å—ñ—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö.

1. –í–∏–∑–Ω–∞—á–∞—î–º–æ –∑–º—ñ–Ω–Ω—ñ (Source of Truth)
–í—ñ–¥–∫—Ä–∏–π —Ñ–∞–π–ª inventory/group_vars/cisco.yml. –î–æ–¥–∞–π —Ç—É–¥–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, —è–∫—ñ –º–∞—é—Ç—å –±—É—Ç–∏ —É –≤—Å—ñ—Ö:

code
Yaml
download
content_copy
expand_less
# ... (—Ç–≤–æ—ó –ª–æ–≥—ñ–Ω/–ø–∞—Ä–æ–ª—å —Ç—É—Ç) ...

# –ì–ª–æ–±–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–µ—Ä–µ–∂—ñ
syslog_server: 192.168.10.10
ntp_server: 192.168.10.1
domain_name: diploma.local
banner_text: |
  ################################################
  #      UNAUTHORIZED ACCESS PROHIBITED          #
  #      MONITORED BY ZABBIX & ANSIBLE           #
  ################################################

2. –ü–ª–µ–π–±—É–∫ (playbooks/apply_standards.yml)

code
Yaml
download
content_copy
expand_less
---
- name: APPLY GLOBAL STANDARDS
  hosts: cisco
  gather_facts: no

  tasks:
    - name: Configure Logging & NTP
      cisco.ios.ios_config:
        lines:
          - "logging host {{ syslog_server }}"
          - "ntp server {{ ntp_server }}"
          - "ip domain-name {{ domain_name }}"

    - name: Configure Banner
      cisco.ios.ios_banner:
        banner: motd
        text: "{{ banner_text }}"
        state: present

–ï—Ñ–µ–∫—Ç: –¢–∏ –∑–º—ñ–Ω–∏–≤ IP —Å–µ—Ä–≤–µ—Ä–∞ –ª–æ–≥—ñ–≤ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ (—É —Ñ–∞–π–ª—ñ –∑–º—ñ–Ω–Ω–∏—Ö), –Ω–∞—Ç–∏—Å–Ω—É–≤ –∫–Ω–æ–ø–∫—É ‚Äî —ñ –≤—Å—ñ 7 –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ –ø–µ—Ä–µ–Ω–∞–ª–∞—à—Ç—É–≤–∞–ª–∏—Å—è.

–†—ñ–≤–µ–Ω—å 2: "–®–∞–±–ª–æ–Ω—ñ–∑–∞—Ü—ñ—è VLAN" (Jinja2 Templates) ‚Äî üî• –¶–ï –¢–û–ü

–¶–µ —Ç–µ, –∑–∞ —â–æ –ø–ª–∞—Ç—è—Ç—å –≤–µ–ª–∏–∫—ñ –≥—Ä–æ—à—ñ. –¢–∏ –Ω–µ –ø–∏—à–µ—à –∫–æ–º–∞–Ω–¥–∏ vlan 10, name SERVER. –¢–∏ —Å—Ç–≤–æ—Ä—é—î—à —à–∞–±–ª–æ–Ω.

–°—Ü–µ–Ω–∞—Ä—ñ–π: –ö–µ—Ä—É–≤–∞–Ω–Ω—è VLAN-–∞–º–∏ —á–µ—Ä–µ–∑ —Å–ø–∏—Å–æ–∫.

1. –û–ø–∏—Å—É—î–º–æ VLAN —É –∑–º—ñ–Ω–Ω–∏—Ö
–°—Ç–≤–æ—Ä–∏ —Ñ–∞–π–ª inventory/host_vars/CORE1.yml (—Å–∞–º–µ –¥–ª—è Core —Å–≤—ñ—Ç—á–∞):

code
Yaml
download
content_copy
expand_less
my_vlans:
  - id: 10
    name: SERVER_NET
  - id: 20
    name: STAFF_NET
  - id: 30
    name: GUEST_IOT
  - id: 40
    name: NEW_IT_DEPT   <-- –î–æ–¥–∞–ª–∏ –Ω–æ–≤–∏–π –≤—ñ–¥–¥—ñ–ª –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–º!

2. –°—Ç–≤–æ—Ä—é—î–º–æ –®–∞–±–ª–æ–Ω (Jinja2)
–°—Ç–≤–æ—Ä–∏ –ø–∞–ø–∫—É templates —ñ —Ñ–∞–π–ª templates/vlans.j2:

code
Jinja2
download
content_copy
expand_less
{# –¶–µ —Ü–∏–∫–ª. –í—ñ–Ω –ø—Ä–æ–π–¥–µ—Ç—å—Å—è –ø–æ —Å–ø–∏—Å–∫—É —ñ —Å—Ç–≤–æ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥–∏ —Å–∞–º #}
{% for vlan in my_vlans %}
vlan {{ vlan.id }}
 name {{ vlan.name }}
!
{% endfor %}

3. –ü–ª–µ–π–±—É–∫ (playbooks/deploy_vlans.yml)

code
Yaml
download
content_copy
expand_less
---
- name: DEPLOY VLANS VIA TEMPLATE
  hosts: core_switches
  gather_facts: no

  tasks:
    - name: Generate Config from Template
      template:
        src: "../templates/vlans.j2"
        dest: "/tmp/vlan_config.txt"

    - name: Push Config to Switch
      cisco.ios.ios_config:
        src: "/tmp/vlan_config.txt"

–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –∑–∞—Ö–∏—Å—Ç—ñ:

–¢–∏ –ø–æ–∫–∞–∑—É—î—à –∫–æ–º—ñ—Å—ñ—ó —Ñ–∞–π–ª YAML: "–û—Å—å —Å–ø–∏—Å–æ–∫ –≤—ñ–¥–¥—ñ–ª—ñ–≤".

–î–æ–¥–∞—î—à —Ç—É–¥–∏ —Ä—è–¥–æ–∫: - id: 99, name: DEMO.

–ó–∞–ø—É—Å–∫–∞—î—à Ansible.

–ó–∞—Ö–æ–¥–∏—à –Ω–∞ —Å–≤—ñ—Ç—á ‚Äî VLAN 99 —Å—Ç–≤–æ—Ä–∏–≤—Å—è!

–ö–æ–º—ñ—Å—ñ—è: üòÆ

–†—ñ–≤–µ–Ω—å 3: "–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –¥—É—Ä–Ω—è" (Check Mode / Dry Run)

Ansible –≤–º—ñ—î –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏, —â–æ –≤—ñ–Ω –∑–±–∏—Ä–∞—î—Ç—å—Å—è –∑—Ä–æ–±–∏—Ç–∏, –Ω–µ —Ä–æ–±–ª—è—á–∏ —Ü—å–æ–≥–æ. –¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

–Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏:
–ë—É–¥—å-—è–∫–∏–π –ø–ª–µ–π–±—É–∫ –∑–∞–ø—É—Å–∫–∞—î—à –∑ –ø—Ä–∞–ø–æ—Ä—Ü–µ–º --check --diff.

code
Bash
download
content_copy
expand_less
ansible-playbook playbooks/deploy_vlans.yml --check --diff

–©–æ –±—É–¥–µ:
Ansible –ø—ñ–¥–∫–ª—é—á–∏—Ç—å—Å—è, –ø–æ—Ä—ñ–≤–Ω—è—î –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —ñ–∑ —à–∞–±–ª–æ–Ω–æ–º —ñ —Å–∫–∞–∂–µ:

"–Ø –± –¥–æ–¥–∞–≤ vlan 99 —ñ –∑–º—ñ–Ω–∏–≤ –Ω–∞–∑–≤—É vlan 10"
–ê–ª–µ –Ω–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–º—ñ–Ω–∏—Ç—å—Å—è.

–©–æ —è —Ä–∞–¥–∂—É —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏?

–ó—Ä–æ–±–∏ –†—ñ–≤–µ–Ω—å 2 (–®–∞–±–ª–æ–Ω–∏) –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è VLAN –∞–±–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

–°—Ç–≤–æ—Ä–∏ –ø–∞–ø–∫—É templates.

–ó—Ä–æ–±–∏ —Ñ–∞–π–ª base_config.j2 (—à–∞–±–ª–æ–Ω) —ñ playbooks/deploy_template.yml.

–¶–µ –ø–æ–∫–∞–∑—É—î, —â–æ —Ç–∏ –≤–æ–ª–æ–¥—ñ—î—à —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—î—é Templating, —è–∫–∞ —î –æ—Å–Ω–æ–≤–æ—é —Å—É—á–∞—Å–Ω–æ–≥–æ DevOps.

–•–æ—á–µ—à –ø—Ä–∏–∫–ª–∞–¥ –ø–æ–≤–Ω–æ–≥–æ –∫–æ–¥—É –¥–ª—è —à–∞–±–ª–æ–Ω—É, —è–∫–∏–π –Ω–∞–ª–∞—à—Ç–æ–≤—É—î —ñ VLAN, —ñ —é–∑–µ—Ä–∞, —ñ –±–∞–Ω–µ—Ä –æ–¥–Ω–∏–º –º–∞—Ö–æ–º?
