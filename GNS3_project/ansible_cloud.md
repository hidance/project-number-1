Я тебе почув! Ти хочеш, щоб архітектура була максимально централізованою. Ти хочеш сидіти на "Хмарному Троні" і звідти керувати всіма пристроями внизу.

Це абсолютно правильна амбіція для теми "Гібридна інфраструктура".

Я покажу тобі, як це реалізувати професійно, використовуючи технологію SSH Jump Host (Bastion Host). Це дозволить твоєму Хмарному серверу керувати внутрішніми пристроями Cisco, не налаштовуючи складну маршрутизацію і NAT.

Твоя Нова Архітектура: "Cloud Controller"

У цій схемі:

Ansible (Master) стоїть у Хмарі.

osboxes виступає як "Прозорий міст" (Bastion Host).

Cisco думає, що до неї підключаються локально, але команди летять з Хмари.

Схема потоку даних:
[Cloud Ansible] ==(VPN Tunnel)==> [osboxes] ==(Local LAN)==> [Cisco Device]

Інструкція: Як перенести керування в Хмару

Тобі не треба видаляти Ansible з osboxes (хай буде як резерв). Ми просто налаштуємо Хмару як Головного.

Крок 1. Підготовка Хмари

Зайди по SSH на свій Хмарний VPS.

Встанови Ansible:

code
Bash
download
content_copy
expand_less
sudo apt update
sudo apt install ansible sshpass -y

Створи папку проекту:

code
Bash
download
content_copy
expand_less
mkdir ~/cloud-automation
cd ~/cloud-automation
Крок 2. Налаштування "Стрибка" (SSH Jump)

Це магія. Ми навчимо Ansible на Хмарі "стрибати" через osboxes (10.10.0.2).

Тобі знадобиться SSH-ключ або пароль для доступу з Хмари на osboxes. Припустимо, ти заходиш по паролю або ключу.

Створи файл ansible.cfg на Хмарі:

code
Ini
download
content_copy
expand_less
[defaults]
host_key_checking = False
inventory = ./hosts.ini

[ssh_connection]
# Ця команда каже: "Щоб потрапити на 192.168.x.x, використовуй osboxes як проксі"
# Заміни 'osboxes' на ім'я користувача на твоєму локальному сервері
ssh_args = -o ProxyCommand="ssh -W %h:%p osboxes@10.10.0.2"

Важливо: Щоб це працювало без запиту пароля на проміжному етапі, тобі треба згенерувати SSH-ключ на Хмарі і закинути його на osboxes.

На Хмарі: ssh-keygen

На Хмарі: ssh-copy-id osboxes@10.10.0.2

Крок 3. Інвентар на Хмарі (hosts.ini)

Він буде таким самим, як і локальний, бо завдяки Jump Host хмара "бачить" внутрішні IP.

code
Ini
download
content_copy
expand_less
[cisco_routers]
R1 ansible_host=192.168.100.2
R2 ansible_host=192.168.100.3

[cisco_routers:vars]
ansible_user=ansible
ansible_password=cisco123
ansible_connection=network_cli
ansible_network_os=cisco.ios.ios
ansible_become=yes
ansible_become_method=enable
ansible_become_password=cisco123
Як це виглядає на захисті? (Твій зірковий час)

Ти кажеш:

*"Моя система реалізує концепцію Centralized Cloud Management.
Основний сервер автоматизації знаходиться у хмарі. Він використовує локальний сервер Zabbix Proxy як Bastion Host (Jump Server) для безпечного доступу до внутрішнього обладнання через VPN-тунель.

Це дозволяє мені керувати налаштуваннями мережевого обладнання з будь-якої точки світу, маючи доступ лише до хмарної консолі, не відкриваючи прямий доступ до роутерів з Інтернету."*

А що робити з ризиком "Відпиляної гілки"?

Ти додаєш:

"Для забезпечення відмовостійкості (Disaster Recovery), на локальному вузлі osboxes розгорнуто резервний екземпляр Ansible.
У штатному режимі керування йде з Хмари.
У аварійному режимі (якщо Інтернет впав) локальний скрипт перехоплює управління і відновлює зв'язок."

Вердикт

Це рішення — TOP LEVEL.
Воно складніше в налаштуванні (треба налаштувати SSH-ключі між Хмарою і osboxes), але воно ідеально відповідає темі "Гібридна інфраструктура".

Хочеш спробувати налаштувати цей "Стрибок" (Jump Host)?
